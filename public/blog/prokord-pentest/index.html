<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta name="keywords" content="Imad Alihodzic, iknek">

    <title>
How Not To Implement Security: An IoT Doorbell Camera Pentest | Imad Alihodzic
</title>

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="generator" content="Hugo 0.140.2">


<link rel="canonical" href="http://localhost:1313/blog/prokord-pentest/" >
<link href="/sass/main.min.a8be33730f01e46b6e968a84ed6b211a9d1286d34f7e143c012da9c14cd56400.css" rel="stylesheet">
<meta name="description" content="A personal blog and website where you can learn more about me and what I do." />    

<link rel="stylesheet" href="/css/main.css">



</head>

<body>

    <div class="flexWrapper">
        <header class="headerWrapper">  
    <div class="header">
        <div>
            <a href="http://localhost:1313/">
                <span class="terminal">iknek@github.io ~ $</span>
            </a>
        </div>
        <input class="side-menu" type="checkbox" id="side-menu">
        <label class="hamb" for="side-menu"><span class="hamb-line"></span></label>
        <nav class="headerLinks">
            <ul>
                
                <li>
                    <a href="http://localhost:1313/blog" title="" >
                        ~/Blog</a>
                </li>
                
                <li>
                    <a href="http://localhost:1313/aboutsite" title="" >
                        ~/About this site</a>
                </li>
                
                <li>
                    <a href="http://localhost:1313/aboutme" title="" >
                        ~/About Me</a>
                </li>
                
            </ul>
        </nav>
    </div>
</header>


        <div class="content">
            <main class="main">
                
<div class="postWrapper">
    <h1>How Not To Implement Security: An IoT Doorbell Camera Pentest</h1>
    
    <section class="postMetadata">
        <dl>
            
                
<dt>tags</dt>
<dd><span></span>
    <a href="/tags/security/">#Security</a><span></span>
    <a href="/tags/pentesting/">#Pentesting</a><span></span>
    <a href="/tags/iot/">#IoT</a></dd>
            
            
            
                
<dt>categories</dt>
<dd><span></span>
    <a href="/categories/pentesting/">Pentesting</a><span></span>
    <a href="/categories/security/">Security</a></dd>
            
            
                <dt>published</dt>
                
                <dd><time datetime="2023-07-28">July 28, 2023</time></dd>
            
            
                <dt>reading time</dt>
                <dd>7 minutes</dd>
            
        </dl>
    </section>
    
    <div>
        <p>This is an &lsquo;informalized&rsquo; summary of my bachelor thesis, written with 5 other persons in the spring of 2023.</p>
<p>Our goals were to devise a pentesting methodology, which would then be used to test the security of a car, and analyse any potential findings. Sadly, time and resource constraints meant that we instead had to perform the test on an IoT product.</p>
<p>Note that, to avoid writing a 13,000 word blogspot, I have decided to skip over many parts of the report, and to shorten many others. Most notably, this post will not discuss:</p>
<ol>
<li>How we devised our methodology (and why).</li>
<li>Our research into the field of security &amp; pentesting.</li>
<li>Most of our tests which yielded no results.</li>
</ol>
<p>If that is of interest, reach out to me for a copy of the thesis.</p>
<h2 id="the-device">The Device</h2>
<p>The product we settled on was a <em>&lsquo;Prokord Smart Home WiFi Door Camera’</em>, purchased through the Swedish electronics retailer Dustin. It is a white-label camera, produced by an unknown Chinese company, and branded and sold under
many different names. The software is written by Tuya, a large Chinese corporation who&rsquo;s software powers millions of IoT devices around the world.</p>
<figure>
    <img src="/post/prokord-pentest/camera.jpg" alt="Picture of cheap silver doorbell camera" class="my-image-class">
    <figcaption>The camera in question</figcaption>
</figure>

<h2 id="reconnaissance">Reconnaissance</h2>
<p>We began with basic passive reconnaissance, trying to find any online/pre-existing information on the camera, and its security mechanisams. This search didn&rsquo;t reveal much, besides from a few Chinese e-commerce listings for the camera under different brands.</p>
<p>Thus, we quickly moved to active reconnaissance, to try and gain a better understanding of the device&rsquo;s hardware configuration. Removing the 4 screws which held the device together from the back revealed two PCBs, which held all the devices&rsquo; integrated electronics.</p>
<p>The top board acts as a daughter-board, passing, among other things, USB power and SD-card data to the board below (referred to herein as the motherboard). Upon removing the daughter-board, the motherboard and its associated components were revealed. Three of the components were of particular interest, namely:</p>
<ul>
<li>The processor - a HiSilicon HI3518E. This is a 32-bit ARM926 processor.</li>
<li>The flash memory - a Winbond 25Q64FWSIG chip with 8 MB of memory.</li>
<li>The exposed (and handily labelled!) UART connecting pads.</li>
</ul>
<figure>
    <img src="/post/prokord-pentest/mobo.jpg" alt="Image: Picture of the motherboard. On it, the CPU, memory, and UART pins are labelled." class="horizontal-class">
    <figcaption>Motherboard with components highlighted</figcaption>
</figure>

<p>Lastly, we decided to do some basic network-scanning. A few different setups were tried, but ultimately the one which provided the most information was when the camera and smartphone (used to control the device) were both connected to a local network hosted on the scanning computer. For scanning, both Nmap was used, to identify the services running on the device and any potentially open ports, as well as Wireshark.</p>
<h2 id="uart-exploitation">UART Exploitation</h2>
<p>From our reconnaissance, the most interesting finding was the exposed UART pads on the motherboard. As such, we decided that this would be our first plan of attack. We began with soldering wires to the RX, TX and GND pads. The baud rate was then discovered by connecting the soldered connection to an oscilloscope via scope probes, from which the oscilloscope automatically deciphered the correct frequency. With this done, we connected our soldered wires to a Serial UART To USB Adapter, which was plugged into a computer running Picocom in Kali Linux.</p>
<figure>
    <img src="/post/prokord-pentest/camera%282%29.jpg" alt="Image: Camera with back case removed, and wires coming from the motherboard connected to our adapter" class="horizontal-class">
    <figcaption>The camera and serial adapter in question</figcaption>
</figure>

<p>So what did we find? Well, as it turns out, <em>everything!</em></p>
<p>Amazingly, with the camera turned on, and Picocom running, its shell terminal was fully exposed. This, by and of itself, provided a large amount of information about the system&rsquo;s software configuration, including:</p>
<ol>
<li>The type and version of the bootloader, that being &lsquo;Das U-boot&rsquo; version 2010.06 (this is a UNIX-like bootloader).</li>
<li>The OS kernel type and version, namely &lsquo;Huawei LiteOS V200R001C10B031&rsquo;, version 1.4.6.</li>
<li>The specific SDK type and version, which is the &lsquo;Tuya IPC SDK&rsquo;, version 4.5.13.</li>
</ol>
<p>The shell terminal also provided a constant log of the camera&rsquo;s operations, mode, and state.</p>
<p>And if this wasn&rsquo;t enough, we found that much more could be done with the shell terminal - as root access was enabled by default! This allowed us to send commands to the camera (for example <code>help</code>, which conveniently shows all the commands available).</p>
<figure>
    <img src="/post/prokord-pentest/tuya%281%29.png" alt="Image: Picocom terminal showing the response from the camera when the help command is called." class="horizontal-class-two">
    <figcaption>Picocom terminal: help command response</figcaption>
</figure>

<p>One particularly useful command is &lsquo;wifi_debug&rsquo;, which prints both the open and closed network ports which the camera uses for communication over WiFi. There are also commands to (amongst other things) read and write data from the camera, as well as view the filesystem and start a telnet session.</p>
<p>To borrow a phrase most commonly used by late night TV-infomercial salesman: <em>&ldquo;But wait&hellip; there&rsquo;s more!&rdquo;</em>. During the boot-up sequence of the camera, the exposed shell provides the practical message &ldquo;<code>Press Ctrl+C to stop autoboot</code>&rdquo;. In doing so, booting to the OS is interrupted, with the camera instead providing complete access to U-Boot (which as the name suggests is the device&rsquo;s bootloader).</p>
<p>Like the OS, U-boot provides a list of commands, with associated explanations, if the help command is run:</p>
<figure>
    <img src="/post/prokord-pentest/uboot.png" alt="Picture of the motherboard. On it, the CPU, memory, and UART pins are labelled." class="horizontal-class-two">
    <figcaption>U-boot: help command response</figcaption>
</figure>

<p>One command of particular interest was ’fatls’. By calling it, one can browse the entire file system of the camera. Whilst many of the directories seem to either be encrypted or compressed, one JFFS2 directory can
be browsed, revealing the ’.wav’ files used for the camera’s sound effects, as well as the configuration files for the camera sensor settings.</p>
<h2 id="remote-attacks">Remote Attacks</h2>
<p>With the camera fully compromised from a physical perspective, our attention turned to finding any remote attacks or, in the least, attacks which didn&rsquo;t require taking apart the camera and soldering wires to it. Since we didn&rsquo;t want to try and exploit/hack the Tuya smartphone app used to control the camera, we took another look at the shell terminal.</p>
<h3 id="qr-code-panic">QR-Code Panic</h3>
<p>By resetting the camera, and going through the pairing-procedure, we found a potentially exploitable buffer. See, to pair a camera and phone, a QR code is displayed in the phone app, which one then scans with the camera. This QR code contains information such as the WiFi SSID name, and password.</p>
<figure>
    <img src="/post/prokord-pentest/sc-of-buffer.png" alt="Picture of shell print, showing buffer" class="horizontal-class-two">
    <figcaption>Screenshot from the UART logs showcasing the buffer put in place for the QR code.</figcaption>
</figure>

<p>Calculating the size of the buffer revealed that the maximum size of the QR code could not exceed 105 bytes. To find out how the camera responded to a QR code larger than 105 bytes, an online tool was used to generate a considerably larger WiFi QR code. By resetting the camera and scanning the new QR code, it was revealed that this caused a buffer overflow internally, which made the whole camera unusable until it was manually factory-reset using the button on the back.</p>
<figure>
    <img src="/post/prokord-pentest/buffer-overflow-error.png" alt="Picture of shell print, showing buffer" class="horizontal-class-two">
    <figcaption>Screenshot from the UART logs showcasing the overflow error corrupting the kernel.</figcaption>
</figure>

<h3 id="dos-attack">DOS Attack</h3>
<p>As mentioned previously, we did a number of network-scans and packet captures. Armed with a list of TCP ports the camera uses, we first set up a WiFi hotspot on a test computer, paired the camera with a phone on the same network, and started up a packet-sender program.</p>
<p>With the setup complete, we began sending as many packets as we could to the device. Within seconds, this caused the camera feed to stop, and the camera completely froze. In short, we managed to perform a DOS without any difficulty!</p>
<h2 id="implication-of-findings">Implication of Findings</h2>
<p>What&rsquo;s (presumably) apparent by now is that this camera has next to no security protections. With relative ease, attackers could gain complete control of it, and/or disable it from working.</p>
<p>However, the discussed attacks aren&rsquo;t even the most egregious faults of this camera. Namely, the camera has no motion-detection, and neither does it have any tamper-protection. This means that if one were to use it in any outdoor setting, all a would-be attack needs to do is wait until you aren&rsquo;t at home &hellip; aaand then remove it from its holder.</p>
<h3 id="manufacturer-response">Manufacturer Response</h3>
<p>As we did our bachelor thesis under strictly defined moral and ethical guidelines, we contacted Tuya and sent all of our findings to them. Whilst I can&rsquo;t share their response word-for-word, I can summarize it by saying that DOS protections aren&rsquo;t a security problem, and any other findings are the fault of the persons who implemented the Tuya software on the camera, and not Tuya.</p>
<h2 id="closing-notes">Closing Notes</h2>
<p>On a personal note, I found our thesis work fascinating. Not only was it a fantastic introduction to cyber-security and pentesting, it was a true eye-opener for me, showing that we can&rsquo;t, and shouldn&rsquo;t, take security for granted. I&rsquo;d love to test more IoT devices in the future, and I will definitely continue learning (and working) with cyber security!</p>
<p>Final Note: As mentioned at the start of this blog post, this is a heavily condensed and reduced accounting of our thesis. If you found this interesting, I&rsquo;d highly recommend you read the full report. Also, I want to thank my hard-working team members, my ever helpful <a href="http://klondike.es">supervisor</a>, Chalmers University, and <a href="https://www.assured.se/">Assured AB</a> who held a CAN Hack course for our group before our our topic-switch.</p>
    </div>
</div>

            </main>
        </div>


        
    </div>

</body>

</html>